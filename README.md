# pockerplan

Приложение для Planning Poker в реальном времени. Позволяет командам совместно оценивать задачи с помощью карточек, голосования и мгновенной синхронизации между участниками.

## Возможности

- Создание комнат с выбором шкалы оценки (Fibonacci, Power of 2, Linear, T-shirt)
- Присоединение к комнате по ссылке
- Голосование за задачи (тикеты) в реальном времени
- Скрытие голосов до момента раскрытия
- Администрирование комнаты: добавление тикетов, запуск/завершение голосования, пропуск тикетов
- Аватарки участников
- Переключение темы оформления: Системная / Тёмная / Светлая (с сохранением выбора)
- Быстрое голосование без тикетов: режим свободного голосования для быстрых оценок
- Горячие клавиши: ввод значения шкалы с клавиатуры, Enter (раскрыть), Space (сброс), стрелки (навигация по тикетам)
- Автоматическая очистка неактивных комнат
- Graceful shutdown сервера

## Стек технологий

- Backend: Go, Centrifuge (WebSocket), Kong (CLI), Zerolog (логирование)
- Frontend: React, TypeScript, Vite, React Router, Biome (линтер/форматтер)
- Коммуникация: WebSocket через Centrifuge
- Единый бинарник: фронтенд встраивается в Go-бинарник через `go:embed`

## Структура проекта

```
pockerplan/
  main.go              -- точка входа, запуск сервера
  ppback/
    hub/               -- Centrifuge-хаб, RPC-обработчики
    server/            -- HTTP-сервер, API-эндпоинты, SPA-фоллбэк
    room/              -- логика комнат и голосования
    model/             -- типы данных (Room, User, Ticket, Vote)
    scale/             -- шкалы оценки
    avatar/            -- аватарки
  ppfront/             -- React-приложение (Vite + TypeScript)
```

## Сборка и запуск

Требования: Go 1.25+, Node.js, npm.

Полная сборка (фронтенд + бэкенд):

```sh
make build
```

Собранный бинарник появится в `bin/pockerplan`.

Запуск:

```sh
./bin/pockerplan
```

По умолчанию сервер слушает на `:8080`. Адрес можно изменить флагом `--addr` или переменной окружения `ADDR`:

```sh
./bin/pockerplan --addr :3000
```

или

```sh
ADDR=:3000 ./bin/pockerplan
```

Справка по доступным флагам:

```sh
./bin/pockerplan --help
```

## Разработка

Запуск фронтенда (Vite dev server) и бэкенда одновременно:

```sh
make dev
```

Сборка только фронтенда:

```sh
make build-frontend
```

Сборка только бэкенда:

```sh
make build-backend
```

## Тесты

Запуск всех тестов:

```sh
make test
```

Только бэкенд:

```sh
make test-backend
```

Только фронтенд:

```sh
make test-frontend
```

## Линтинг и форматирование

Проверка кода (lint):

```sh
cd ppfront && npm run lint
```

Автоформатирование:

```sh
cd ppfront && npm run format
```

## API

| Эндпоинт                 | Метод | Описание                           |
|---------------------------|-------|------------------------------------|
| `/connection/websocket`   | WS    | WebSocket-подключение (Centrifuge) |
| `/api/scales`             | GET   | Список доступных шкал оценки      |
| `/api/avatars`            | GET   | Список аватарок                    |
| `/api/health`             | GET   | Проверка состояния сервера         |
